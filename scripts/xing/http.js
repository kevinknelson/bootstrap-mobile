define(["jquery"],function(f){var d=f("body"),h=f(d.data("progressDisplay")),l=f(d.data("statusMessage")),a=window.location.pathname,j=a.substring(0,a.lastIndexOf("/")),g="//"+window.location.host+j,i=0,k=function(){if(h.length>0){h.show();i++}},e=function(){if(--i<1){i=0;h.hide()}},c=function(n,m){return function(o){if(m){e()}n(f.parseJSON(o.response))}},b={BasePath:j,SitePath:g,redirect:function(m){k();window.location.href=m.replace("~",this.BasePath)},get:function(o,n,p,m){b.ajax("GET",o,n,p,m)},post:function(o,n,p,m){b.ajax("POST",o,n,p,m)},put:function(o,n,p,m){b.ajax("PUT",o,n,p,m)},ajax:function(m,p,o,q,n){n=n||false;f.ajax({type:m,url:p.replace("~",this.BasePath),data:o,success:n?q:function(r){e();q(r)},error:c(q,!n)});if(!n){k()}},stackCall:k,unstackCall:e,forceEndStack:function(){i=0;e()},message:function(o,n,m,p){if(l.length){l.find(".content").html(o);l.toggleClass("error",!!n).show("fast");setTimeout(function(){l.hide("fast");if(p){p()}},typeof m=="undefined"?1400:(m*1000))}}};return b});